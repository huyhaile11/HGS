<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>L·ªäCH C·ªêNG HI·∫æN HGS - Xanh nh·∫°t</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <style>
    body { font-family: 'Inter', sans-serif; background: #eef4fb; color: #1f2937; }
    .card { background: #ffffff; border-radius: 1rem; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
    .toast {
      position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
      background: rgba(59,130,246,0.95); color: white; padding: 10px 18px;
      border-radius: 10px; font-weight: 600; z-index: 9999; animation: fadeInOut 2s forwards;
    }
    @keyframes fadeInOut {
      0% { opacity: 0; transform: translate(-50%, -55%); }
      10%, 90% { opacity: 1; transform: translate(-50%, -50%); }
      100% { opacity: 0; transform: translate(-50%, -45%); }
    }
    #suggestions { z-index: 50; }
    table.result-table th, table.result-table td {
      padding: 8px 6px; border-bottom: 1px solid #e5e7eb; font-size: 13px; text-align:left; vertical-align: middle;
    }
    table.result-table td.center { text-align:center; }
    .day-container { background: white; border: 1px solid #dbeafe; border-radius: 10px; padding: 10px 12px; box-shadow: 0 2px 6px rgba(0,0,0,0.03); }
    .day-title { font-weight: 700; font-size: 15px; padding: 4px 0; color: #2563eb; }
    .day-past { opacity: 0.6; background: #f8fafc; }
    .day-today { border: 2px solid #3b82f6; box-shadow: 0 0 10px rgba(59,130,246,0.15); }
    .btn-main { background: #3b82f6; color: white; border-radius: 8px; padding: 10px 0; font-weight: 600; width: 100%; }
    .btn-main:hover { background: #2563eb; }
    .btn-danger { background: #ef4444; color: white; border-radius: 8px; padding: 10px 0; font-weight: 600; width: 100%; }
    .btn-yellow { background: #facc15; color: #1f2937; border-radius: 8px; padding: 10px 0; font-weight: 600; width: 100%; }
    .checkbox-wrapper { display: flex; align-items: center; gap: 6px; cursor: pointer; user-select: none; }
    .checkbox-wrapper input { width: 16px; height: 16px; }
  </style>
</head>

<body class="p-3">
<div class="max-w-lg mx-auto card p-4 space-y-4">

<!-- ===== PH·∫¶N TR√äN GI·ªÆ NGUY√äN HO√ÄN TO√ÄN ===== -->
<!-- (to√†n b·ªô HTML form, upload, l·ªãch tu·∫ßn, l√†m h·ªô‚Ä¶ kh√¥ng thay ƒë·ªïi) -->

<!-- ===== PH·∫¶N JAVASCRIPT ===== -->
<script>
/* ================= JAVASCRIPT CH√çNH ================= */
const c = id => document.getElementById(id);
const daysOrder = ["MON","TUE","WED","THU","FRI","SAT","SUN"];
let flightData = [];

function removeDiacritics(str){
  if(!str) return "";
  return str.normalize('NFD').replace(/[\u0300-\u036f]/g, '').replace(/ƒë/g,'d').replace(/ƒê/g,'D');
}
function normalizeText(s){
  if(!s) return "";
  return removeDiacritics(s).replace(/[^A-Z0-9\s\-]/gi,'').trim().replace(/\s+/g,' ').toUpperCase();
}
function exactNameMatches(a,b){ return a===b; }

/* =====================================================
   üîç TRA C·ª®U CHUY·∫æN BAY ‚Äì CH·ªà HI·ªÇN TH·ªä NG√ÄY H√îM NAY
   ===================================================== */
function renderFlightResults(nameRaw){
  const container=c("flight-result");
  if(!flightData.length){
    container.innerHTML=`<p class="text-center text-gray-500 italic">Ch∆∞a c√≥ d·ªØ li·ªáu. H√£y t·∫£i file Excel.</p>`;
    return;
  }

  const qNorm=normalizeText(nameRaw);
  let matches=flightData.filter(d=>exactNameMatches(qNorm,d.nameNormalized));
  if(!matches.length){
    container.innerHTML=`<p class="text-center text-gray-500 italic">Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu cho "${nameRaw}"</p>`;
    return;
  }

  const grouped={}; daysOrder.forEach(d=>grouped[d]=[]);
  matches.forEach(m=>grouped[m.sheet].push(m));

  const now=new Date();
  const vnWeekday=new Intl.DateTimeFormat('vi-VN',{timeZone:'Asia/Bangkok',weekday:'long'}).format(now).toLowerCase();
  const mapVN={'th·ª© hai':0,'th·ª© ba':1,'th·ª© t∆∞':2,'th·ª© nƒÉm':3,'th·ª© s√°u':4,'th·ª© b·∫£y':5,'ch·ªß nh·∫≠t':6};
  const todayIndex=mapVN[vnWeekday] ?? new Date().getDay()-1;

  let html="";

  /* ===== CH·ªà HI·ªÇN TH·ªä NG√ÄY H√îM NAY ===== */
  [daysOrder[todayIndex]].forEach(day=>{
    const rows=grouped[day];
    html+=`<div class="day-container day-today">
      <div class="day-title">${day}</div>`;

    if(!rows.length){
      html+=`<p class="text-gray-400 italic">Kh√¥ng c√≥ d·ªØ li·ªáu</p>`;
    } else {
      html+=`<table class="w-full result-table mt-1">
        <thead><tr>
          <th>FLT</th><th>ETD</th><th>SUP</th><th>GATE</th><th>K·∫øt s·ªï</th><th>WLC</th><th>Boarding</th>
        </tr></thead><tbody>`;
      rows.forEach(r=>{
        let brd=r.tag==="BRD"?"‚úÖ":r.tag==="NO"?"‚ùå":"";
        html+=`<tr>
          <td>${r.flt||'‚Äî'}</td>
          <td>${r.etd||'‚Äî'}</td>
          <td class="center">${r.supFlag?'‚úÖ':''}</td>
          <td class="center">${r.gateFlag?'‚úÖ':''}</td>
          <td class="center">${r.ketsoFlag?'‚úÖ':''}</td>
          <td class="center">${r.wlctFlag?'‚úÖ':''}</td>
          <td class="center">${brd}</td>
        </tr>`;
      });
      html+=`</tbody></table>`;
    }
    html+=`</div>`;
  });

  container.innerHTML=html;
}
</script>

</div>
</body>
</html>
